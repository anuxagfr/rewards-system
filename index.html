<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rewards - Shakuntlam</title>
  <style>
    body{font-family:Segoe UI,Arial;margin:0;background:#f9f9f9;color:#333}
    header{background:#4a148c;color:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center}
    header h1{margin:0}
    nav a{color:#fff;margin-left:1rem;cursor:pointer;text-decoration:none;font-weight:500}
    nav a:hover{text-decoration:underline}
    .hero{background:linear-gradient(rgba(74,20,140,0.7),rgba(74,20,140,0.7)),url('https://picsum.photos/1600/800?blur=2') no-repeat center/cover;color:#fff;text-align:center;padding:5rem 2rem}
    .hero h2{font-size:2.5rem}
    .hero button{background:#ffca28;border:none;padding:0.8rem 1.5rem;border-radius:8px;font-size:1rem;font-weight:bold;cursor:pointer}
    .hero button:hover{background:#ffc107}
    .modal{display:none;position:fixed;z-index:999;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6)}
    .modal-content{background:#fff;margin:5% auto;padding:2rem;border-radius:10px;max-width:400px;position:relative}
    .modal-content input{width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:6px}
    .modal-content button{width:100%;background:#4a148c;color:#fff;border:none;padding:10px;border-radius:6px;margin-top:10px}
    .toggle{color:#4a148c;cursor:pointer;font-size:0.9rem;text-align:center;display:block;margin-top:10px}
    .error{color:red;font-size:0.9rem;text-align:center}
    .success{color:green;font-size:0.9rem;text-align:center}
    .close{position:absolute;right:10px;top:10px;cursor:pointer;font-size:1.2rem}
  </style>
</head>
<body>
  <header>
    <h1>Shakuntlam Rewards</h1>
    <nav>
      <a id="loginBtn">Login</a>
      <a id="signupBtn">Sign Up</a>
    </nav>
  </header>

  <div class="hero">
    <h2>Earn Points. Get Rewards.</h2>
    <p>Shop and claim 1% back as reward points!</p>
    <button id="joinNow">Join Now</button>
  </div>

  <!-- Modal -->
  <div class="modal" id="authModal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h2 id="modalTitle">Login</h2>

      <!-- Login -->
      <form id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email" required/>
        <input type="password" id="loginPassword" placeholder="Password" required/>
        <button type="submit">Login</button>
        <div id="loginError" class="error"></div>
        <span class="toggle" id="forgotLink">Forgot Password?</span>
        <span class="toggle" id="toSignup">Donâ€™t have account? Sign Up</span>
      </form>

      <!-- Signup -->
      <form id="signupForm" style="display:none;">
        <input type="text" id="signupName" placeholder="Full Name" required/>
        <input type="email" id="signupEmail" placeholder="Email" required/>
        <input type="tel" id="signupPhone" placeholder="Phone Number"/>
        <input type="password" id="signupPassword" placeholder="Password" required/>
        <button type="submit">Register</button>
        <div id="signupError" class="error"></div>
        <div id="signupSuccess" class="success"></div>
        <span class="toggle" id="toLogin">Already have account? Login</span>
      </form>

      <!-- Reset -->
      <form id="resetForm" style="display:none;">
        <input type="email" id="resetEmail" placeholder="Enter email" required/>
        <button type="submit">Send Reset Link</button>
        <div id="resetMsg"></div>
        <span class="toggle" id="backLogin">Back to Login</span>
      </form>
    </div>
  </div>

<script>
  const modal=document.getElementById('authModal');
  const loginBtn=document.getElementById('loginBtn');
  const signupBtn=document.getElementById('signupBtn');
  const joinNow=document.getElementById('joinNow');
  const closeModal=document.getElementById('closeModal');
  const loginForm=document.getElementById('loginForm');
  const signupForm=document.getElementById('signupForm');
  const resetForm=document.getElementById('resetForm');
  const modalTitle=document.getElementById('modalTitle');

  loginBtn.onclick=()=>{modal.style.display="block";modalTitle.textContent="Login";loginForm.style.display="block";signupForm.style.display="none";resetForm.style.display="none";}
  signupBtn.onclick=()=>{modal.style.display="block";modalTitle.textContent="Sign Up";signupForm.style.display="block";loginForm.style.display="none";resetForm.style.display="none";}
  joinNow.onclick=()=>signupBtn.click();
  closeModal.onclick=()=>modal.style.display="none";
  window.onclick=e=>{if(e.target==modal)modal.style.display="none";}
  document.getElementById("toSignup").onclick=()=>signupBtn.click();
  document.getElementById("toLogin").onclick=()=>loginBtn.click();
  document.getElementById("forgotLink").onclick=()=>{modalTitle.textContent="Reset Password";loginForm.style.display="none";signupForm.style.display="none";resetForm.style.display="block";}
  document.getElementById("backLogin").onclick=()=>loginBtn.click();
</script>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  const app=initializeApp(firebaseConfig);
  const auth=getAuth(app);
  const db=getFirestore(app);

  // Signup
  document.getElementById("signupForm").addEventListener("submit",async(e)=>{
    e.preventDefault();
    const name=signupName.value,email=signupEmail.value,phone=signupPhone.value,pwd=signupPassword.value;
    try{
      const u=await createUserWithEmailAndPassword(auth,email,pwd);
      await setDoc(doc(db,"users",u.user.uid),{name,email,phone,role:"user",points:0});
      signupSuccess.textContent="Registered! Redirecting...";
      setTimeout(()=>location.href="user.html",1500);
    }catch(err){signupError.textContent=err.message;}
  });

  // Login
  document.getElementById("loginForm").addEventListener("submit",async(e)=>{
    e.preventDefault();
    try{
      const u=await signInWithEmailAndPassword(auth,loginEmail.value,loginPassword.value);
      const snap=await getDoc(doc(db,"users",u.user.uid));
      if(snap.exists()){
        if(snap.data().role==="admin") location.href="admin.html";
        else location.href="user.html";
      }else loginError.textContent="Role not assigned.";
    }catch(err){loginError.textContent=err.message;}
  });

  // Reset
  document.getElementById("resetForm").addEventListener("submit",async(e)=>{
    e.preventDefault();
    try{
      await sendPasswordResetEmail(auth,resetEmail.value);
      resetMsg.textContent="Email sent!";resetMsg.style.color="green";
    }catch(err){resetMsg.textContent=err.message;resetMsg.style.color="red";}
  });
</script>
</body>
</html>
