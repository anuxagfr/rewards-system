<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shakuntlam Rewards</title>
  <style>
    body{font-family:Segoe UI,Arial;margin:0;background:#f9f9f9;color:#333}
    header{background:#4a148c;color:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center}
    header h1{margin:0}
    nav a{color:#fff;margin-left:1rem;cursor:pointer;text-decoration:none;font-weight:500}
    nav a:hover{text-decoration:underline}
    .hero{background:linear-gradient(rgba(74,20,140,0.7),rgba(74,20,140,0.7)),url('https://picsum.photos/1600/800?blur=2') no-repeat center/cover;color:#fff;text-align:center;padding:5rem 2rem}
    .hero h2{font-size:2.5rem}
    .hero button{background:#ffca28;border:none;padding:0.8rem 1.5rem;border-radius:8px;font-size:1rem;font-weight:bold;cursor:pointer}
    .hero button:hover{background:#ffc107}
    .modal{display:none;position:fixed;z-index:999;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6)}
    .modal-content{background:#fff;margin:5% auto;padding:2rem;border-radius:10px;max-width:400px;position:relative}
    .modal-content input{width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:6px}
    .modal-content button{width:100%;background:#4a148c;color:#fff;border:none;padding:10px;border-radius:6px;margin-top:10px}
    .toggle{color:#4a148c;cursor:pointer;font-size:0.9rem;text-align:center;display:block;margin-top:10px}
    .error{color:red;font-size:0.9rem;text-align:center}
    .success{color:green;font-size:0.9rem;text-align:center}
    .close{position:absolute;right:10px;top:10px;cursor:pointer;font-size:1.2rem}
    button:disabled{opacity:0.6;cursor:not-allowed}
  </style>
</head>
<body>
  <header>
    <h1>Shakuntlam Rewards</h1>
    <nav>
      <a id="loginBtn">Login</a>
      <a id="signupBtn">Sign Up</a>
    </nav>
  </header>

  <div class="hero">
    <h2>Earn Points. Get Rewards.</h2>
    <p>Shop and claim 1% back as reward points!</p>
    <button id="joinNow">Join Now</button>
  </div>

  <!-- Modal -->
  <div class="modal" id="authModal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h2 id="modalTitle">Login</h2>

      <!-- Login -->
      <form id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email" required/>
        <input type="password" id="loginPassword" placeholder="Password" required/>
        <button type="submit" id="loginSubmit">Login</button>
        <div id="loginError" class="error"></div>
        <span class="toggle" id="forgotLink">Forgot Password?</span>
        <span class="toggle" id="toSignup">Donâ€™t have account? Sign Up</span>
      </form>

      <!-- Signup -->
      <form id="signupForm" style="display:none;">
        <input type="text" id="signupName" placeholder="Full Name" required/>
        <input type="email" id="signupEmail" placeholder="Email" required/>
        <input type="tel" id="signupPhone" placeholder="Phone Number"/>
        <input type="password" id="signupPassword" placeholder="Password" required/>
        <button type="submit" id="signupSubmit">Register</button>
        <div id="signupError" class="error"></div>
        <div id="signupSuccess" class="success"></div>
        <span class="toggle" id="toLogin">Already have account? Login</span>
      </form>

      <!-- Reset -->
      <form id="resetForm" style="display:none;">
        <input type="email" id="resetEmail" placeholder="Enter email" required/>
        <button type="submit" id="resetSubmit">Send Reset Link</button>
        <div id="resetMsg"></div>
        <span class="toggle" id="backLogin">Back to Login</span>
      </form>
    </div>
  </div>

<script>
  // ===== Modal switching
  const modal=document.getElementById('authModal');
  const loginBtn=document.getElementById('loginBtn');
  const signupBtn=document.getElementById('signupBtn');
  const joinNow=document.getElementById('joinNow');
  const closeModal=document.getElementById('closeModal');
  const loginForm=document.getElementById('loginForm');
  const signupForm=document.getElementById('signupForm');
  const resetForm=document.getElementById('resetForm');
  const modalTitle=document.getElementById('modalTitle');

  loginBtn.onclick=()=>{showForm("login")}
  signupBtn.onclick=()=>{showForm("signup")}
  joinNow.onclick=()=>signupBtn.click();
  closeModal.onclick=()=>modal.style.display="none";
  window.onclick=e=>{if(e.target==modal)modal.style.display="none";}
  document.getElementById("toSignup").onclick=()=>signupBtn.click();
  document.getElementById("toLogin").onclick=()=>loginBtn.click();
  document.getElementById("forgotLink").onclick=()=>showForm("reset");
  document.getElementById("backLogin").onclick=()=>loginBtn.click();

  function showForm(type){
    modal.style.display="block";
    loginForm.style.display = (type==="login")?"block":"none";
    signupForm.style.display= (type==="signup")?"block":"none";
    resetForm.style.display  = (type==="reset")?"block":"none";
    modalTitle.textContent = type==="login"?"Login":type==="signup"?"Sign Up":"Reset Password";
  }
</script>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCAcVmMBM5cuXmydgj3LpunqXgjPVWW2SI",
    authDomain: "reward-20359.firebaseapp.com",
    projectId: "reward-20359",
    storageBucket: "reward-20359.firebasestorage.app",
    messagingSenderId: "577324459963",
    appId: "1:577324459963:web:d969522318bcb229ae869e",
    measurementId: "G-TX647FT78R"
  };
  const app=initializeApp(firebaseConfig);
  const auth=getAuth(app);
  const db=getFirestore(app);

  // ===== Prevent multiple clicks helper
  function disableBtn(btn,disable=true){
    if(disable) btn.setAttribute("disabled","true");
    else btn.removeAttribute("disabled");
  }

  // ===== Signup
  signupForm.addEventListener("submit",async(e)=>{
    e.preventDefault();
    const btn=document.getElementById("signupSubmit");
    disableBtn(btn,true);
    signupError.textContent=""; signupSuccess.textContent="";
    try{
      const u=await createUserWithEmailAndPassword(auth,signupEmail.value,signupPassword.value);
      await setDoc(doc(db,"users",u.user.uid),{
        name:signupName.value,email:signupEmail.value,
        phone:signupPhone.value,role:"user",points:0
      });
      signupSuccess.textContent="Registered! Redirecting...";
      setTimeout(()=>location.href="user.html",1500);
    }catch(err){ signupError.textContent=err.message; }
    disableBtn(btn,false);
  });

  // ===== Login
  loginForm.addEventListener("submit",async(e)=>{
    e.preventDefault();
    const btn=document.getElementById("loginSubmit");
    disableBtn(btn,true);
    loginError.textContent="";
    try{
      const u=await signInWithEmailAndPassword(auth,loginEmail.value,loginPassword.value);
      const snap=await getDoc(doc(db,"users",u.user.uid));
      if(snap.exists()){
        if(snap.data().role==="admin") location.href="admin.html";
        else location.href="user.html";
      }else loginError.textContent="Role not assigned.";
    }catch(err){ loginError.textContent=err.message; }
    disableBtn(btn,false);
  });

  // ===== Reset
  resetForm.addEventListener("submit",async(e)=>{
    e.preventDefault();
    const btn=document.getElementById("resetSubmit");
    disableBtn(btn,true);
    resetMsg.textContent="";
    try{
      await sendPasswordResetEmail(auth,resetEmail.value);
      resetMsg.textContent="Email sent!"; resetMsg.style.color="green";
    }catch(err){ resetMsg.textContent=err.message; resetMsg.style.color="red"; }
    disableBtn(btn,false);
  });
</script>
</body>
</html>
