<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rewards</title>
     <link rel="stylesheet" href="style.css">
  
</head>
<body>

  <header>
    <h1> Rewards</h1>
    <nav>

      <a id="joinBtn">Join Now</a>
    
      <a id="loginBtn">Login</a>
    </nav>
  </header>

  <section class="hero">
    <h2>Earn Points. Get Rewards.</h2>
    <p>Shop with Shakuntlam and earn points on every purchase. Redeem for exclusive gifts and offers!</p>
    <button id="joinNowBtn">Join Now</button>
  </section>

  <section class="features">
    <div class="card"><h3>Earn Points</h3><p>Every ₹100 spent = 1 Reward Point.</p></div>
    <div class="card"><h3>Exclusive Rewards</h3><p>Redeem points for discounts & gifts.</p></div>
    <div class="card"><h3>Track Easily</h3><p>Check your rewards anytime.</p></div>
  </section>

  <footer><p>© 2025 Rewards | All Rights Reserved</p></footer>

  <!-- Auth Modal -->
  <div id="authModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h2 id="modalTitle">Login</h2>

      <!-- Login Form -->
      <form id="login-form">
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button type="submit">Login</button>
        <div id="loginError" class="error"></div>
        <span class="toggle-link" id="forgotPassword">Forgot Password?</span>
        <span class="toggle-link" id="toSignup">Don’t have an account? Sign Up</span>
      </form>

      <!-- Signup Form -->
      <form id="signup-form" style="display:none;">
        <input type="text" id="signupName" placeholder="Full Name" required>
        <input type="email" id="signupEmail" placeholder="Email" required>
        <input type="tel" id="signupPhone" placeholder="Phone Number" required>
        <input type="password" id="signupPassword" placeholder="Password" required>
        <button type="submit">Register</button>
        <div id="signupError" class="error"></div>
        <div id="signupSuccess" class="success"></div>
        <span class="toggle-link" id="toLogin">Already have an account? Login</span>
      </form>

      <!-- Reset Form -->
      <form id="reset-form" style="display:none;">
        <input type="email" id="resetEmail" placeholder="Enter your email" required>
        <button type="submit">Send Reset Link</button>
        <div id="resetMsg"></div>
        <span class="toggle-link" id="backToLogin">Back to Login</span>
      </form>
    </div>
  </div>

<script>

  const modal = document.getElementById('authModal');
  const joinBtn = document.getElementById('joinBtn');
  const joinNowBtn = document.getElementById('joinNowBtn');
  const loginBtn = document.getElementById('loginBtn');
  const closeModal = document.getElementById('closeModal');
  const loginForm = document.getElementById('login-form');
  const signupForm = document.getElementById('signup-form');
  const resetForm = document.getElementById('reset-form');
  const modalTitle = document.getElementById('modalTitle');

joinBtn.onclick = () => { modal.style.display="block"; modalTitle.textContent="Sign Up"; loginForm.style.display="none"; signupForm.style.display="block"; resetForm.style.display="none"; }
joinNowBtn.onclick = () => { modal.style.display="block"; modalTitle.textContent="Sign Up"; loginForm.style.display="none"; signupForm.style.display="block"; resetForm.style.display="none"; }
  loginBtn.onclick = () => { modal.style.display="block"; modalTitle.textContent="Login"; loginForm.style.display="block"; signupForm.style.display="none"; resetForm.style.display="none"; }
  closeModal.onclick = () => modal.style.display="none";
  window.onclick = e => { if(e.target==modal) modal.style.display="none"; }
  document.getElementById("toSignup").onclick = () => { modalTitle.textContent="Sign Up"; loginForm.style.display="none"; signupForm.style.display="block"; resetForm.style.display="none"; }
  document.getElementById("toLogin").onclick = () => { modalTitle.textContent="Login"; signupForm.style.display="none"; loginForm.style.display="block"; resetForm.style.display="none"; }
  document.getElementById("forgotPassword").onclick = () => { modalTitle.textContent="Reset Password"; loginForm.style.display="none"; signupForm.style.display="none"; resetForm.style.display="block"; }
  document.getElementById("backToLogin").onclick = () => { modalTitle.textContent="Login"; resetForm.style.display="none"; loginForm.style.display="block"; }
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA0fmYGnjo84ZA9ld2HG5fcodySXbykBPw",
    authDomain: "rewards-97547.firebaseapp.com",
    projectId: "rewards-97547",
    storageBucket: "rewards-97547.appspot.com",
    messagingSenderId: "386741383248",
    appId: "1:386741383248:web:9be63e316c8c791823a155",
    measurementId: "G-79D3270T1P"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Signup
  document.getElementById("signup-form").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const name=document.getElementById("signupName").value;
    const email=document.getElementById("signupEmail").value;
    const phone=document.getElementById("signupPhone").value;
    const password=document.getElementById("signupPassword").value;
    const errorBox=document.getElementById("signupError");
    const successBox=document.getElementById("signupSuccess");
    errorBox.textContent=""; successBox.textContent="";
    try{
      const userCred=await createUserWithEmailAndPassword(auth,email,password);
      await setDoc(doc(db,"users",userCred.user.uid),{name,email,phone,role:"user",points:0,createdAt:new Date()});
      successBox.textContent="Registration successful! Redirecting...";
      setTimeout(()=>{window.location.href="user.html";},2000);
    }catch(err){ errorBox.textContent=err.message; }
  });

  // Login
  document.getElementById("login-form").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const email=document.getElementById("loginEmail").value;
    const password=document.getElementById("loginPassword").value;
    const errorBox=document.getElementById("loginError");
    try{
      const userCred=await signInWithEmailAndPassword(auth,email,password);
      const user=userCred.user;
      const snap=await getDoc(doc(db,"users",user.uid));
      if(snap.exists()){
        if(snap.data().role==="admin"){ window.location.href="admin.html"; }
        else{ window.location.href="user.html"; }
      }else{ errorBox.textContent="No role assigned. Contact support."; }
    }catch(err){ errorBox.textContent=err.message; }
  });

  // Reset Password
  document.getElementById("reset-form").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const email=document.getElementById("resetEmail").value;
    const msg=document.getElementById("resetMsg");
    try{
      await sendPasswordResetEmail(auth,email);
      msg.textContent="Reset link sent!"; msg.style.color="green";
    }catch(err){ msg.textContent=err.message; msg.style.color="red"; }
  });
</script>
</body>
</html>

